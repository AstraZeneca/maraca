---
title: "Plotting win odds"
author: "Monika Huhn"
date: "10/10/2023"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, collapse = TRUE)
library(dplyr)
library(ggplot2)
library(maraca)
```

## Component plot

The maraca package also contains an additional plot
called `"component_plot"`. This one allows to plot the
different components that make up the win odds calculation.
More specifically, for each outcome, the plot shows how
often patients in each treatment arm "won" against the other
arm. For the time-to-event endpoints, this means counting how many
patients of the other arm had no event prior. For the continuous
outcome this means counting how many patients had a lower value.
The results are separated for each outcome (non-cumulative)
and also include ties (patients from 2 treatment arms having same
outcome at the same time/same continuous outcome value).

Let us first read in some data.
```{r maraca1, eval = TRUE}
library(maraca)

data(hce_scenario_a)
```

In order to use the `component_plot`, we have to first create a
`maraca` object. Important here is to set the argument
`compute_win_odds = TRUE`, so that the necessary calculations
are included.
```{r}
maraca_dat <- maraca(
  data = hce_scenario_a,
  tte_outcomes = c("Outcome I", "Outcome II", "Outcome III", "Outcome IV"),
  continuous_outcome = "Continuous outcome",
  fixed_followup_days = 3 * 365,
  column_names = c(outcome = "GROUP", arm = "TRTP", value = "AVAL0"),
  arm_levels = c(active = "Active", control = "Control"),
  # Make sure to calculate the win odds
  compute_win_odds = TRUE
)
```

Now we can just plot the object using the `component_plot()` function.
```{r}
component_plot(maraca_dat)
```

It is also possible to use the `component_plot()` function directly on
an `hce` object (created using the
[hce package](https://cran.r-project.org/web/packages/hce/index.html).
```{r}
library(hce)

set.seed(31337)
Rates_A <- c(1.72, 1.74, 0.58, 1.5, 1)
Rates_P <- c(2.47, 2.24, 2.9, 4, 6)

hce_dat <- simHCE(n = 2500, TTE_A = Rates_A, TTE_P = Rates_P,
              CM_A = -3, CM_P = -6, CSD_A = 16, CSD_P = 15, fixedfy = 3)

component_plot(hce_dat)
```

## Styling

The resulting plot is a normal ggplot2 object that can be styled accordingly.