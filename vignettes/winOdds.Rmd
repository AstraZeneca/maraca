---
title: "Maraca Plots - Plotting win odds"
author: "Monika Huhn"
date: "10/10/2023"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Maraca Plots - Plotting win odds}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, collapse = TRUE)
library(dplyr)
library(ggplot2)
library(maraca)
```

## Component plot

The maraca package also contains an additional plot
called `"component_plot"`. This one allows to plot the
different components that make up the win odds calculation.
More specifically, for each outcome, the plot shows how
often patients in each treatment arm "won" against the other
arm. For the time-to-event endpoints, this means counting how many
patients of the other arm had no event prior. For the continuous
outcome this means counting how many patients had a lower value.
The results are separated for each outcome (non-cumulative)
and also include ties (patients from 2 treatment arms having same
outcome at the same time/same continuous outcome value).

Let us first read in some data.
```{r maraca1, eval = TRUE}
library(maraca)

data(hce_scenario_a)
```

In order to use the `component_plot`, we have to first create a
`maraca` object. Important here is to set the argument
`compute_win_odds = TRUE`, so that the necessary calculations
are included.
```{r}
maraca_dat <- maraca(
  data = hce_scenario_a,
  step_outcomes = c("Outcome I", "Outcome II", "Outcome III", "Outcome IV"),
  last_outcome = "Continuous outcome",
  fixed_followup_days = 3 * 365,
  column_names = c(outcome = "GROUP", arm = "TRTP", value = "AVAL0"),
  arm_levels = c(active = "Active", control = "Control"),
  # Make sure to calculate the win odds
  compute_win_odds = TRUE
)
```

Now we can just plot the object using the `component_plot()` function.
```{r fig.width=7, fig.height=6}
component_plot(maraca_dat)
```

It is also possible to use the `component_plot()` function directly on
an `hce` object (created using the
[hce package](https://cran.r-project.org/package=hce)).

```{r fig.width=7, fig.height=6}
library(hce)

Rates_A <- c(1.72, 1.74, 0.58, 1.5, 1)
Rates_P <- c(2.47, 2.24, 2.9, 4, 6)

hce_dat <- simHCE(n = 2500, TTE_A = Rates_A, TTE_P = Rates_P,
                  CM_A = -3, CM_P = -6, CSD_A = 16, CSD_P = 15, fixedfy = 3,
                  seed = 31337)

component_plot(hce_dat)
```

## Cumulative plot

Furthermore, there is also a plot called `"cumulative_plot"`.
Similar as above, this plot shows the different components that
make up the win odds calculation. Different to the component plot,
this plot shows the endpoint cumulated instead (adding one
hierarchical endpoint at a time).
As explained above, the plot shows how
often patients in the active arm "won" or "lost" against the other
arm or if they had a "tie".

As before, in order to use the `cumulative_plot`, we have to first create a
`maraca` object. Important here is to set the argument
`compute_win_odds = TRUE`, so that the necessary calculations
are included.
```{r}
maraca_dat <- maraca(
  data = hce_scenario_a,
  step_outcomes = c("Outcome I", "Outcome II", "Outcome III", "Outcome IV"),
  last_outcome = "Continuous outcome",
  fixed_followup_days = 3 * 365,
  column_names = c(outcome = "GROUP", arm = "TRTP", value = "AVAL0"),
  arm_levels = c(active = "Active", control = "Control"),
  # Make sure to calculate the win odds
  compute_win_odds = TRUE
)
```

Now we can just plot the object using the `cumulative_plot()` function.
```{r fig.width=7, fig.height=6}
cumulative_plot(maraca_dat)
```

It is also possible to use the `cumulative_plot()` function directly on
an `hce` object (created using the
[hce package](https://cran.r-project.org/package=hce)).

```{r fig.width=7, fig.height=6}
cumulative_plot(hce_dat)
```

## Styling

The resulting plots for both the `component_plot()` and  `cumulative_plot()` functions
are normal ggplot2 objects that can be styled accordingly.
There are also different themes available to style the plot.

The default style is called `theme = "maraca"`.
```{r fig.width=7, fig.height=6}
component_plot(maraca_dat, theme = "maraca")
```

There are 2 different themes with different color
schemes, `theme = "color1"` and `theme = "color2"`.
```{r fig.width=7, fig.height=6}
cumulative_plot(maraca_dat, theme = "color1")
```

```{r fig.width=7, fig.height=6}
component_plot(maraca_dat, theme = "color2")
```

There is also a theme without any styling `theme = "none"`.
```{r fig.width=8, fig.height=6}
cumulative_plot(maraca_dat, theme = "none")
```
